---
import type { WebSite, WithContext } from 'schema-dts'
import { Image } from 'astro:assets'
import { getCollection } from 'astro:content'

import Layout from '../layouts/layout.astro'
import Link from '../components/link.astro'
import ProjectThumbnailList from '../components/project-thumbnail-list.astro'
import RecentTracks from '../components/recent-tracks.astro'
import siteMetadata from '../helpers/site-metadata'

import meSvg from '../assets/me.svg'

const site = Astro.site?.toString()

const title = 'Guillem Andreu - Web Developer and Designer'
const description =
	'Hi. I’m Guillem, a web developer and designer based in Berlin. This is my Website.'

const jsonLd: WithContext<WebSite> = {
	'@context': 'https://schema.org',
	'@type': 'WebSite',
	name: title,
	alternateName: 'Guillem Andreu’s Website.',
	description,
	url: site,
	inLanguage: {
		'@type': 'Language',
		name: 'English',
		alternateName: 'en',
	},
	author: {
		'@type': 'Person',
		name: siteMetadata.author.name,
		url: site,
		sameAs: [
			`https://bsky.app/profile/${siteMetadata.author.social.bluesky}`,
			`https://github.com/${siteMetadata.author.social.github}`,
			`https://www.last.fm/user/${siteMetadata.author.social.lastfm}`,
			`https://www.linkedin.com/in/${siteMetadata.author.social.linkedin}/`,
		],
	},
	locationCreated: {
		'@type': 'City',
		name: 'Berlin',
	},
}

const allProjects = await getCollection('project')
const featuredProjects = allProjects
	.filter((project) => project.data.featured === true)
	.sort(
		(a, b) =>
			b.data.date.year - a.data.date.year ||
			b.data.date.month - a.data.date.month,
	)
	.map((project) => ({
		id: project.id,
		thumbnail: project.data.thumbnail,
		title: project.data.title,
	}))
---

<Layout title={title} meta={{ title, description }}>
	<script
		is:inline
		slot="head-meta"
		type="application/ld+json"
		set:html={JSON.stringify(jsonLd)}
	/>
	<section class="home-about">
		<p class="home-about-text">
			<strong>Hi. I’m Guillem,</strong> a web developer and designer based in Berlin<span
				class="period">.</span
			>
			<br />
			<Link href="/about/">More about me</Link>
		</p>
		<div class="home-about-image">
			<Image alt="A drawn silouethe of myself" loading="eager" src={meSvg} />
		</div>
	</section>
	<section class="home-work">
		<p>
			Here are some of the <Link href="/work/">things I make</Link>:
		</p>
		<ProjectThumbnailList items={featuredProjects} />
	</section>
	<RecentTracks user={siteMetadata.author.social.lastfm} server:defer>
		<RecentTracks slot="fallback" />
	</RecentTracks>
</Layout>

<style lang="scss">
	@use '../styles/utils/mixins' as m;

	@layer layout {
		.home-about {
			@include m.forward-grid;
			align-items: center;
			font-size: 1.9rem;
			justify-items: center;
			line-height: 1.3;
			margin-block: var(--margin-small);
			margin-inline: 0;
		}

		.home-about-image,
		.home-about-text {
			grid-column: 2 / span 11;
		}

		.home-about-image {
			display: flex;
			grid-row: 1;

			@media (prefers-reduced-motion: no-preference) {
				transition:
					opacity var(--transition-duration-slow) var(--cubic-bezier-ease-out),
					transform var(--transition-duration-slow) var(--cubic-bezier-ease-out);
				@starting-style {
					opacity: 0.75;
					transform: scale(0.95);
				}
			}

			img {
				filter: drop-shadow(0 0 var(--spacing) #fff);
				height: 5em;
				margin: auto;
				width: auto;
			}
		}

		.home-about-text {
			font-family: var(--font-stack-serif);
			font-weight: 200;
			grid-row: 2;
			margin: 0;
			max-width: 8.5em;

			strong {
				font-weight: 700;
			}

			a {
				font-family: var(--font-stack-sans);
				font-size: 1rem;
				font-weight: 400;
			}
		}

		.home-work {
			grid-column: 1 / span 13;
		}

		@media (width >= 35em) {
			.home-about {
				justify-items: start;
			}

			.home-about-image,
			.home-about-text {
				grid-row: 1;
			}

			.home-about-image {
				grid-column: 9 / span 4;

				img {
					height: 6.5em;
					margin: 0;
				}
			}

			.home-about-text {
				grid-column: 2 / span 7;
			}
		}

		@media (width >= 40em) {
			.home-about {
				font-size: 2.4rem;
				margin-block: var(--margin-medium);
				margin-inline: 0;
			}

			.home-about-text a {
				font-size: 0.5em;
			}

			.home-work {
				p {
					font-size: 1.25rem;
				}
			}
		}

		@media (width >= 52em) {
			.home-about {
				font-size: 3rem;
			}

			.home-work {
				p {
					font-size: 1.5rem;
				}
			}
		}

		@media (width >= 72em) {
			.home-about-image {
				grid-column: 9 / span 3;
			}

			.home-about-text {
				grid-column: 3 / span 6;
			}
		}
	}
</style>
